const SEASON_DATA={spring:{icon:"🌸",name:"春",title:"春の調べ",description:"桜咲く季節の温かな希望と新しい始まりを表現した楽曲集",poster:"./img/秀歌-春.webp",video:{webm:null,mp4:"./video/光のほうへ.mp4"},tracks:[{title:"光のほうへ",description:"新緑の季節に響く希望のメロディー",src:"./audio/光のほうへ.mp3"},{title:"ひかりのあと",description:"春の陽だまりで感じる穏やかな時間",src:"./audio/ひかりのあと.mp3"}]},tsuyu:{icon:"☔️",name:"梅雨",title:"梅雨の音色",description:"雨の季節の静けさと潤いを感じる楽曲集",poster:"./img/秀歌-梅雨.webp",video:{webm:null,mp4:"./video/夏庭園の歌.mp4"},tracks:[{title:"ひかりのあと",description:"春の陽だまりで感じる穏やかな時間",src:"./audio/ひかりのあと.mp3"},{title:"緑の中のひととき",description:"木陰で過ごす静寂な時間",src:"./audio/緑の中のひととき.mp3"}]},summer:{icon:"🌻",name:"夏",title:"夏の響き",description:"緑豊かな季節の生命力と情熱を込めた楽曲集",poster:"./img/秀歌-夏.webp",video:{webm:null,mp4:"./video/夏庭園の歌.mp4"},tracks:[{title:"夏庭園の詩",description:"緑陰の中で感じる夏の情景",src:"./audio/夏庭園の詩.mp3"},{title:"緑の中のひととき",description:"木陰で過ごす静寂な時間",src:"./audio/緑の中のひととき.mp3"}]},autumn:{icon:"🍁",name:"秋",title:"秋の詩",description:"色づく季節の深い情感と静寂を表現した楽曲集",poster:"./img/秀歌-秋.webp",video:{webm:null,mp4:"./video/洛陽の宵.mp4"},tracks:[{title:"洛陽の宵（よい）",description:"秋の夜に響く古都の響き",src:"./audio/落葉の宵(よい).mp3"},{title:"風の庭にて",description:"秋風に舞う葉音のハーモニー",src:"./audio/風の庭にて.mp3"}]},winter:{icon:"❄️",name:"冬",title:"冬の静寂",description:"雪景色の中の静けさと内省を込めた楽曲集",poster:"./img/秀歌-冬.webp",video:{webm:null,mp4:"./video/白のなかで.mp4"},tracks:[{title:"白のなかで",description:"雪に包まれた世界の静寂",src:"./audio/白のなかで.mp3"},{title:"しろのことば",description:"雪降る夜の静寂な語らい",src:"./audio/しろのことば.mp3"}]}};function initAccessibilityFeatures(){if(document.addEventListener("mousedown",()=>document.body.classList.add("using-mouse")),document.addEventListener("keydown",()=>document.body.classList.remove("using-mouse")),document.addEventListener("keydown",handleGlobalKeyboard),!document.getElementById("aria-live-region")){const e=document.createElement("div");e.id="aria-live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e)}}function handleGlobalKeyboard(e){if(e.altKey)switch(e.key){case"1":e.preventDefault();const t=document.getElementById("home");t&&t.focus();break;case"2":e.preventDefault();const n=document.getElementById("about");n&&n.focus();break;case"3":e.preventDefault();const a=document.getElementById("gallery");a&&a.focus();break;case"4":e.preventDefault();const s=document.getElementById("contact");s&&s.focus()}if("Escape"===e.key){const e=document.getElementById("nav-menu"),t=document.getElementById("nav-toggle");e&&e.classList.contains("active")&&(e.classList.remove("active"),t&&(t.classList.remove("active"),t.focus()))}}function initResourcePrefetching(){"requestIdleCallback"in window&&requestIdleCallback(()=>{["./img/秀歌-春.webp","./img/秀歌-夏.webp","./img/秀歌-秋.webp","./img/秀歌-冬.webp"].forEach(e=>{const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)})})}class Navigation{constructor(){this.navToggle=document.getElementById("nav-toggle"),this.navMenu=document.getElementById("nav-menu"),this.navLinks=document.querySelectorAll('.nav-menu a[href^="#"]'),this.header=document.getElementById("header"),this.init()}init(){this.bindEvents(),this.handleScroll()}bindEvents(){this.navToggle&&this.navToggle.addEventListener("click",()=>this.toggleMobileMenu()),this.navLinks.forEach(e=>{e.addEventListener("click",e=>this.handleSmoothScroll(e))}),document.addEventListener("click",e=>this.handleOutsideClick(e)),window.addEventListener("scroll",()=>this.handleScroll()),document.addEventListener("keydown",e=>this.handleEscapeKey(e))}toggleMobileMenu(){this.navMenu.classList.contains("active")?this.closeMobileMenu():this.openMobileMenu()}openMobileMenu(){this.navMenu.classList.add("active"),this.navToggle&&(this.navToggle.classList.add("active"),this.navToggle.setAttribute("aria-expanded","true"),this.navToggle.setAttribute("aria-label","メニューを閉じる")),document.body.style.overflow="hidden";const e=this.navMenu.querySelector("a, button");e&&e.focus()}closeMobileMenu(){this.navMenu.classList.remove("active"),this.navToggle&&(this.navToggle.classList.remove("active"),this.navToggle.setAttribute("aria-expanded","false"),this.navToggle.setAttribute("aria-label","メニューを開く")),document.body.style.overflow="",this.navToggle&&this.navToggle.focus()}handleSmoothScroll(e){e.preventDefault();const t=e.target.getAttribute("href").substring(1),n=document.getElementById(t);if(n){this.navMenu.classList.contains("active")&&this.closeMobileMenu();const e=this.header.offsetHeight,a=n.offsetTop-e;window.scrollTo({top:a,behavior:"smooth"}),history.pushState(null,null,`#${t}`),this.updateActiveNavLink(t)}}smoothScrollTo(e){const t=window.pageYOffset,n=e-t;let a=null;const s=e=>{null===a&&(a=e);const i=e-a,o=Math.min(i/400,1),r=o<.5?4*o*o*o:(o-1)*(2*o-2)*(2*o-2)+1;window.scrollTo(0,t+n*r),i<400&&requestAnimationFrame(s)};requestAnimationFrame(s)}updateActiveNavLink(e){this.navLinks.forEach(t=>{t.getAttribute("href").substring(1)===e?(t.classList.add("active"),t.setAttribute("aria-current","page")):(t.classList.remove("active"),t.removeAttribute("aria-current"))})}handleOutsideClick(e){!(this.navMenu.contains(e.target)||this.navToggle&&this.navToggle.contains(e.target))&&this.navMenu.classList.contains("active")&&this.closeMobileMenu()}handleEscapeKey(e){"Escape"===e.key&&this.navMenu.classList.contains("active")&&this.closeMobileMenu()}handleScroll(){window.pageYOffset>100?this.header.classList.add("scrolled"):this.header.classList.remove("scrolled"),this.updateActiveNavOnScroll()}updateActiveNavOnScroll(){const e=["home","about","gallery","contact"],t=this.header.offsetHeight,n=window.pageYOffset+t+100;let a="home";for(const t of e){const e=document.getElementById(t);e&&n>=e.offsetTop&&(a=t)}this.updateActiveNavLink(a)}}window.scrollToSection=function(e){const t=document.getElementById(e),n=document.getElementById("header");if(t&&n){const e=n.offsetHeight,a=t.offsetTop-e;window.scrollTo({top:a,behavior:"smooth"})}},"undefined"!=typeof module&&module.exports&&(module.exports=Navigation),SEASON_DATA.winter.video.mp4="./video/白のなかで.mp4";class SeasonsGallery{constructor(){this.seasonButtons=document.querySelectorAll(".season-btn"),this.seasonPanels=document.querySelectorAll(".season-panel"),this.currentSeason="tsuyu",this.audioElements=[],this.videoElements=[],this.init()}init(){this.bindEvents(),this.setupAudioElements(),this.preloadWashiBackgrounds(),this.loadInitialSeason()}bindEvents(){this.seasonButtons.forEach(e=>{e.addEventListener("click",e=>this.handleSeasonChange(e)),e.addEventListener("keydown",e=>this.handleKeyboardNavigation(e))}),document.addEventListener("play",e=>this.handleAudioPlay(e),!0),document.addEventListener("pause",e=>this.handleAudioPause(e),!0),document.addEventListener("click",e=>{if(e.target.classList.contains("season-video"))return e.preventDefault(),void this.handleVideoClick(e);const t=e.target.closest(".season-visual");if(t){const n=t.querySelector(".season-video");if(n&&e.target!==n){e.preventDefault();const t={target:n,preventDefault:()=>{}};this.handleVideoClick(t)}}}),document.addEventListener("keydown",e=>{e.target.classList.contains("season-video")&&this.handleVideoKeydown(e)})}setupAudioElements(){this.audioElements=Array.from(document.querySelectorAll("audio")),this.videoElements=Array.from(document.querySelectorAll(".season-video")),this.audioElements.forEach(e=>{e.volume=.5,e.preload="none";const t=e.parentElement.querySelector(".track-title"),n=t?t.textContent:"Track";e.setAttribute("aria-label",`${n}の音楽プレーヤー`)}),this.videoElements.forEach(e=>{e.volume=.5,e.preload="none",e.muted=!1;const t=e.closest(".season-panel"),n=t?t.querySelector(".season-title"):null,a=n?n.textContent:"Video";e.setAttribute("aria-label",`${a}のデモ動画`)})}refresh(){this.seasonButtons=document.querySelectorAll(".season-btn"),this.seasonPanels=document.querySelectorAll(".season-panel"),this.bindEvents(),this.setupAudioElements()}preloadWashiBackgrounds(){["./img/和紙-春.webp","./img/和紙-夏.webp","./img/和紙-秋.webp","./img/和紙-冬.webp","./img/和紙-梅雨.webp"].forEach(e=>{(new Image).src=e})}loadInitialSeason(){this.currentSeason="",this.updateURL("tsuyu"),this.updateSeasonBackground("tsuyu"),"function"==typeof window.enableRain&&window.enableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.enableSakura&&"spring"===this.currentSeason&&window.enableSakura(!1),this.updateSeasonButtons(""),this.updateSeasonPanels("",!1)}getSeasonFromURL(){const e=new URLSearchParams(window.location.search).get("season");return["spring","summer","autumn","winter","tsuyu"].includes(e)?e:null}getSeasonFromStorage(){try{const e=localStorage.getItem("lastSeason");if(["spring","summer","autumn","winter","tsuyu"].includes(e))return e}catch(e){}return null}getSeasonFromDate(){const e=(new Date).getMonth()+1;return e>=3&&e<=5?"spring":e>=6&&e<=8?"summer":e>=9&&e<=11?"autumn":"winter"}handleSeasonChange(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-season");t&&t!==this.currentSeason&&this.switchToSeason(t)}handleKeyboardNavigation(e){const t=Array.from(this.seasonButtons).indexOf(e.currentTarget);let n=t;switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),n=(t+1)%this.seasonButtons.length;break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),n=(t-1+this.seasonButtons.length)%this.seasonButtons.length;break;case"Home":e.preventDefault(),n=0;break;case"End":e.preventDefault(),n=this.seasonButtons.length-1;break;case"Enter":case" ":return e.preventDefault(),void this.handleSeasonChange(e);default:return}this.seasonButtons[n].focus()}switchToSeason(e,t=!0){if(!["spring","summer","autumn","winter","tsuyu"].includes(e))return;this.stopAllAudio(),this.updateSeasonButtons(e),this.updateSeasonPanels(e,t);const n=this.currentSeason;this.currentSeason=e;try{localStorage.setItem("lastSeason",e)}catch(e){}if(this.updateURL(e),t&&this.updateAboutImage(e),this.updateSeasonBackground(e),"spring"===e){const t=n!==e&&null!==n;"function"==typeof window.enableSakura&&window.enableSakura(t),"function"==typeof window.disableRain&&window.disableRain(),"function"==typeof window.disableSnow&&window.disableSnow(),"function"==typeof window.disableAutumnLeaves&&window.disableAutumnLeaves(),"function"==typeof window.disableSummerWillow&&window.disableSummerWillow()}else"tsuyu"===e?("function"==typeof window.enableRain&&window.enableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.disableSnow&&window.disableSnow()):"winter"===e?("function"==typeof window.enableSnow&&window.enableSnow(),"function"==typeof window.disableRain&&window.disableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.disableAutumnLeaves&&window.disableAutumnLeaves()):"autumn"===e?("function"==typeof window.enableAutumnLeaves&&window.enableAutumnLeaves(),"function"==typeof window.disableRain&&window.disableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.disableSnow&&window.disableSnow(),"function"==typeof window.disableSummerWillow&&window.disableSummerWillow()):"summer"===e?("function"==typeof window.enableSummerWillow&&window.enableSummerWillow(),"function"==typeof window.disableRain&&window.disableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.disableSnow&&window.disableSnow(),"function"==typeof window.disableAutumnLeaves&&window.disableAutumnLeaves()):("function"==typeof window.disableRain&&window.disableRain(),"function"==typeof window.disableSakura&&window.disableSakura(),"function"==typeof window.disableSnow&&window.disableSnow(),"function"==typeof window.disableAutumnLeaves&&window.disableAutumnLeaves(),"function"==typeof window.disableSummerWillow&&window.disableSummerWillow());this.announceSeasonChange(e)}updateSeasonButtons(e){this.seasonButtons.forEach(t=>{const n=t.getAttribute("data-season")===e;t.classList.toggle("active",n),t.setAttribute("aria-selected",n.toString()),n?t.setAttribute("tabindex","0"):t.setAttribute("tabindex","-1")})}updateSeasonPanels(e,t){this.seasonPanels.forEach(n=>{n.getAttribute("data-season")===e?this.showPanel(n,t):this.hidePanel(n,t)})}showPanel(e,t){e.style.display="grid",e.classList.add("active"),t&&(e.style.opacity="0",e.style.transform="scale(0.97)",e.style.transition="opacity 0.4s ease, transform 0.4s ease",requestAnimationFrame(()=>{e.style.opacity="1",e.style.transform="scale(1)"}),setTimeout(()=>{e.style.transition="",e.style.opacity="",e.style.transform=""},400),this.animatePanelChildren(e,!0)),e.setAttribute("aria-hidden","false"),this.loadVideoForPanel(e,!1)}hidePanel(e,t){t?(this.animatePanelChildren(e,!1),e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="0",e.style.transform="scale(0.97)",setTimeout(()=>{e.style.transition="",e.style.display="none",e.classList.remove("active"),e.style.opacity="",e.style.transform=""},300)):(e.style.display="none",e.classList.remove("active")),e.setAttribute("aria-hidden","true")}animatePanelChildren(e,t){const n=e.querySelector(".season-visual"),a=e.querySelector(".season-tracks"),s=e.querySelector(".season-title"),i=e.querySelector(".season-description");if(t){if(n&&(n.style.opacity="0",n.style.transform="translateX(-80px)",n.style.transition="opacity 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) 0.1s, transform 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) 0.1s",requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateX(0)"}),setTimeout(()=>{n.style.transition="",n.style.opacity="",n.style.transform=""},800)),a){[s,i].forEach((e,t)=>{e&&(e.style.opacity="0",e.style.transform="translateX(60px)",e.style.transition=`opacity 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) ${.2+.1*t}s, transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) ${.2+.1*t}s`,requestAnimationFrame(()=>{e.style.opacity="1",e.style.transform="translateX(0)"}),setTimeout(()=>{e.style.transition="",e.style.opacity="",e.style.transform=""},700+100*t))}),a.style.opacity="0",a.style.transform="translateX(100px)",a.style.transition="opacity 0.8s cubic-bezier(0.25, 0.1, 0.25, 1) 0.3s, transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1) 0.3s",requestAnimationFrame(()=>{a.style.opacity="1",a.style.transform="translateX(0)"}),setTimeout(()=>{a.style.transition="",a.style.opacity="",a.style.transform=""},1100);a.querySelectorAll(".track").forEach((e,t)=>{e.style.opacity="0",e.style.transform="translateX(40px)",e.style.transition=`opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) ${.5+.08*t}s, transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) ${.5+.08*t}s`,requestAnimationFrame(()=>{e.style.opacity="1",e.style.transform="translateX(0)"}),setTimeout(()=>{e.style.transition="",e.style.opacity="",e.style.transform=""},1e3+80*t)})}}else if(n&&(n.style.transition="opacity 0.4s cubic-bezier(0.25, 0.1, 0.25, 1), transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)",n.style.opacity="0",n.style.transform="translateX(-60px)"),a){a.querySelectorAll(".track").forEach((e,t)=>{e.style.transition=`opacity 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) ${.03*t}s, transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) ${.03*t}s`,e.style.opacity="0",e.style.transform="translateX(30px)"}),[s,i,a].forEach((e,t)=>{e&&(e.style.transition=`opacity 0.4s cubic-bezier(0.25, 0.1, 0.25, 1) ${.1+.05*t}s, transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1) ${.1+.05*t}s`,e.style.opacity="0",e.style.transform="translateX(50px)")})}}loadVideoForPanel(e,t=!1){const n=e.querySelector(".season-video");if(!n||"true"===n.dataset.loaded)return void(t&&n&&n.paused&&n.play().catch(e=>{console.error("Video play failed:",e)}));n.style.opacity="0.7";n.querySelectorAll("source[data-src]").forEach(e=>{const t=e.getAttribute("data-src");t&&(e.src=t)}),n.load(),n.dataset.loaded="true",n.style.opacity="1",t&&n.play().catch(e=>{console.error("Video play failed:",e)})}updateURL(e){const t=new URL(window.location);t.searchParams.set("season",e),history.replaceState(null,"",t.toString())}updateSeasonBackground(e){const t={spring:"./img/和紙-春.webp",summer:"./img/和紙-夏.webp",autumn:"./img/和紙-秋.webp",winter:"./img/和紙-冬.webp",tsuyu:"./img/和紙-梅雨.webp"}[e];if(t){const n=new Image;n.onload=()=>{document.body.setAttribute("data-season",e);const t=document.getElementById("header");t&&t.setAttribute("data-season",e);const n=document.getElementById("season-selector");n&&"function"==typeof n.updateActive&&n.updateActive(e)},n.src=t}else{document.body.setAttribute("data-season",e);const t=document.getElementById("header");t&&t.setAttribute("data-season",e);const n=document.getElementById("season-selector");n&&"function"==typeof n.updateActive&&n.updateActive(e)}this.updateFavicon(e)}updateFavicon(e){const t=encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="16">${{spring:"🌸",tsuyu:"☔️",summer:"🌻",autumn:"🍁",winter:"❄️"}[e]||"🌸"}</text></svg>`);let n=document.querySelector('link[rel="icon"]');n||(n=document.createElement("link"),n.rel="icon",document.head.appendChild(n)),n.setAttribute("href",`data:image/svg+xml,${t}`)}updateAboutImage(e){const t=document.querySelector(".about-image");if(!t)return;const n={spring:"./img/秀歌-春-btn.webp",summer:"./img/秀歌-夏-btn.webp",autumn:"./img/秀歌-秋-btn.webp",winter:"./img/秀歌-冬-btn.webp",tsuyu:"./img/秀歌-梅雨.webp"}[e];if(n){const e=new Image;e.onload=()=>{t.src=n,t.srcset=n;const e=t.parentElement.querySelector("source");e&&(e.srcset=n)},e.src=n}}announceSeasonChange(e){const t=`${{spring:"春",summer:"夏",autumn:"秋",winter:"冬",tsuyu:"梅雨"}[e]}の楽曲に切り替わりました`;let n=document.getElementById("season-announcer");n||(n=document.createElement("div"),n.id="season-announcer",n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="visually-hidden",document.body.appendChild(n)),n.textContent=t}handleAudioPlay(e){if("AUDIO"===e.target.tagName){this.audioElements.forEach(t=>{t===e.target||t.paused||t.pause()}),this.videoElements.forEach(e=>{e.paused||e.pause()});const t=e.target.closest(".track");t&&t.classList.add("playing")}if("VIDEO"===e.target.tagName){this.audioElements.forEach(e=>{e.paused||e.pause()}),this.videoElements.forEach(t=>{t===e.target||t.paused||t.pause()});const t=e.target.closest(".season-panel");t&&t.classList.add("video-playing")}}handleAudioPause(e){if("AUDIO"===e.target.tagName){const t=e.target.closest(".track");t&&t.classList.remove("playing")}if("VIDEO"===e.target.tagName){const t=e.target.closest(".season-panel");t&&t.classList.remove("video-playing")}}handleVideoClick(e){const t=e.target;if(t&&t.tagName&&"video"===t.tagName.toLowerCase()){if("true"!==t.dataset.loaded){const e=t.closest(".season-panel");e&&this.loadVideoForPanel(e,!0)}else t.paused?t.play().catch(e=>{console.error("Video play failed:",e)}):(console.log("Pausing video..."),t.pause());e.preventDefault&&e.preventDefault()}else console.warn("handleVideoClick called without valid video element")}handleVideoKeydown(e){const t=e.target;"Space"!==e.code&&"Enter"!==e.code||(e.preventDefault(),this.handleVideoClick(e)),"ArrowLeft"===e.code&&(e.preventDefault(),t.currentTime=Math.max(0,t.currentTime-5)),"ArrowRight"===e.code&&(e.preventDefault(),t.currentTime=Math.min(t.duration,t.currentTime+5))}showPlayNote(e){const t=e.currentTarget;if(t._playNote)return;const n=document.createElement("div");n.className="play-note",n.innerHTML='♪<span class="visually-hidden">クリックで再生</span>',document.body.appendChild(n),n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,t._playNote=n,"function"==typeof window.createCustomRipple&&window.createCustomRipple(e.clientX,e.clientY,getComputedStyle(n).color)}movePlayNote(e){const t=e.currentTarget._playNote;t&&(t.style.left=`${e.clientX}px`,t.style.top=`${e.clientY}px`)}hidePlayNote(e){this.removePlayNote(e.currentTarget)}removePlayNote(e){const t=e._playNote;t&&(t.remove(),e._playNote=null)}stopAllAudio(){this.audioElements.forEach(e=>{e.paused||e.pause()}),this.videoElements.forEach(e=>{e.paused||e.pause()})}getCurrentSeason(){return this.currentSeason}getAvailableSeasons(){return["spring","summer","autumn","winter"]}}function switchSeason(e){window.seasonsGallery&&"function"==typeof window.seasonsGallery.switchToSeason&&window.seasonsGallery.switchToSeason(e)}function initSeasonSelector(){const e=document.getElementById("season-selector");if(!e)return;const t=e.querySelectorAll("button[data-season]");e.updateActive=e=>{t.forEach(t=>{const n=t.getAttribute("data-season")===e;t.classList.toggle("active",n),t.setAttribute("aria-checked",n)})},window.seasonsGallery&&"function"==typeof window.seasonsGallery.getCurrentSeason&&e.updateActive(window.seasonsGallery.getCurrentSeason()),e.addEventListener("click",e=>{const t=e.target.closest("button[data-season]");if(!t)return;const n=t.getAttribute("data-season");"function"==typeof window.switchSeason&&window.switchSeason(n)})}function setupFooterSeasonButtons(){document.querySelectorAll(".footer-season-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-season");n&&window.switchSeason&&window.switchSeason(n)})})}window.switchSeason=switchSeason,window.initSeasonSelector=initSeasonSelector,"undefined"!=typeof module&&module.exports&&(module.exports=SeasonsGallery),window.SeasonsGallery=SeasonsGallery;class ShukaApp{constructor(){this.isLoaded=!1,this.observers=new Map,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.onDOMReady()):this.onDOMReady()}onDOMReady(){this.setupIntersectionObserver(),this.setupFormHandling(),this.setupPerformanceOptimizations(),this.setupAccessibilityEnhancements(),this.setupErrorHandling();const e=document.getElementById("main-content");e&&e.scrollIntoView({behavior:"auto"}),this.isLoaded=!0,document.dispatchEvent(new CustomEvent("shukaAppReady"))}setupIntersectionObserver(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.animateElement(e.target)})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".feature, .track, .about-visual, .contact-form").forEach(t=>{e.observe(t)}),this.observers.set("animation",e)}animateElement(e){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return e.style.opacity="1",void(e.style.transform="none");e.classList.contains("feature")?e.classList.add("animate-slide-in-left"):e.classList.contains("about-visual")?e.classList.add("animate-slide-in-right"):e.classList.add("animate-fade-in"),setTimeout(()=>{e.classList.remove("animate-slide-in-left","animate-slide-in-right","animate-fade-in")},600)}setupFormHandling(){const e=document.querySelector(".contact-form");if(e){e.addEventListener("submit",e=>this.handleFormSubmit(e));e.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("blur",()=>this.validateField(e)),e.addEventListener("input",()=>this.clearFieldError(e))})}}handleFormSubmit(e){e.preventDefault();const t=e.target;this.validateForm(t)&&(this.setFormLoadingState(t,!0),setTimeout(()=>{this.showFormSuccess(t),this.setFormLoadingState(t,!1),t.reset()},2e3))}validateForm(e){const t=e.querySelectorAll("[required]");let n=!0;return t.forEach(e=>{this.validateField(e)||(n=!1)}),n}validateField(e){const t=e.value.trim(),n=e.type;let a=!0,s="";if(e.hasAttribute("required")&&!t&&(a=!1,s="この項目は必須です"),"email"===n&&t){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(a=!1,s="メールアドレスの形式が正しくありません")}return this.showFieldError(e,a?"":s),a}showFieldError(e,t){if(this.clearFieldError(e),t){e.classList.add("error"),e.setAttribute("aria-invalid","true");const n=document.createElement("div");n.className="field-error",n.textContent=t,n.id=`${e.id}-error`,e.setAttribute("aria-describedby",n.id),e.parentNode.appendChild(n)}}clearFieldError(e){e.classList.remove("error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");const t=e.parentNode.querySelector(".field-error");t&&t.remove()}setFormLoadingState(e,t){const n=e.querySelector(".form-submit"),a=e.querySelectorAll("input, textarea, button");t?(n.textContent="送信中...",n.disabled=!0,a.forEach(e=>e.disabled=!0)):(n.textContent="送信する",n.disabled=!1,a.forEach(e=>e.disabled=!1))}showFormSuccess(e){const t=document.createElement("div");t.className="form-success",t.innerHTML='\n      <div class="success-content">\n        <span class="success-icon">✓</span>\n        <p>お問い合わせありがとうございます。<br>お返事まで今しばらくお待ちください。</p>\n      </div>\n    ',e.style.display="none",e.parentNode.appendChild(t),setTimeout(()=>{t.remove(),e.style.display="block"},5e3)}setupPerformanceOptimizations(){if("IntersectionObserver"in window){const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src"),e.unobserve(n))}})});document.querySelectorAll("img[data-src]").forEach(t=>e.observe(t)),this.observers.set("images",e)}document.addEventListener("mouseover",this.preloadOnHover,{once:!0}),document.addEventListener("touchstart",()=>this.preloadOnTouch(),{once:!0})}preloadOnHover(){["./img/秀歌-春.webp","./img/秀歌-夏.webp","./img/秀歌-秋.webp","./img/秀歌-冬.webp"].forEach(e=>{const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)})}preloadOnTouch(){this.preloadOnHover()}setupAccessibilityEnhancements(){document.querySelectorAll(".skip-link").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("href").substring(1),a=document.getElementById(n);a&&(a.focus(),a.scrollIntoView())})}),document.addEventListener("keydown",e=>{"Tab"===e.key&&this.handleTabKey(e)}),this.setupRouteAnnouncements()}handleTabKey(e){const t=document.querySelector(".modal.active");t&&this.trapFocus(e,t)}trapFocus(e,t){const n=t.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'),a=n[0],s=n[n.length-1];e.shiftKey?document.activeElement===a&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),a.focus())}setupRouteAnnouncements(){window.addEventListener("hashchange",()=>{const e=window.location.hash.substring(1);if(e){const t=document.getElementById(e);if(t){const e=t.querySelector("h1, h2, h3");e&&this.announceToScreenReader(`${e.textContent}セクションに移動しました`)}}})}announceToScreenReader(e){let t=document.getElementById("screen-reader-announcer");t||(t=document.createElement("div"),t.id="screen-reader-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="visually-hidden",document.body.appendChild(t)),t.textContent=e}setupErrorHandling(){window.addEventListener("error",()=>{}),window.addEventListener("unhandledrejection",()=>{})}debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}}throttle(e,t){let n;return function(){const a=arguments,s=this;n||(e.apply(s,a),n=!0,setTimeout(()=>n=!1,t))}}destroy(){this.observers.forEach(e=>e.disconnect()),this.observers.clear()}}window.shukaApp=new ShukaApp;const additionalCSS="\n  .field-error {\n    color: var(--accent);\n    font-size: var(--text-sm);\n    margin-top: var(--space-1);\n  }\n  \n  .form-input.error,\n  .form-textarea.error {\n    border-color: var(--accent);\n    box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);\n  }\n  \n  .form-success {\n    background: var(--spring);\n    color: white;\n    padding: var(--space-8);\n    border-radius: var(--radius-xl);\n    text-align: center;\n    animation: fadeIn 0.5s ease-out;\n  }\n  \n  .success-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-4);\n  }\n  \n  .success-icon {\n    font-size: var(--text-4xl);\n    width: 60px;\n    height: 60px;\n    background: rgba(255, 255, 255, 0.2);\n    border-radius: var(--radius-full);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .track.playing {\n    background: var(--primary-light);\n    color: white;\n  }\n",additionalStyle=document.createElement("style");additionalStyle.textContent=additionalCSS,function(){const e=(new Date).getMonth()+1;let t="spring";[6,7,8].includes(e)?t="summer":[9,10,11].includes(e)?t="autumn":[12,1,2].includes(e)&&(t="winter"),document.body.dataset.season=t}();class WaterRippleEffect{constructor(){this.container=document.getElementById("ripple-container"),this.isActive=!0,this.lastRippleTime=0,this.throttleDelay=400,this.maxRipples=12,this.ripples=[],this.petalLimit=100,this.frameTime=0,this.performanceOptimized=!1,this.init()}init(){this.container&&(this.checkUserPreferences(),this.bindEvents())}checkUserPreferences(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return this.isActive=!1,void(this.container.style.display="none");if(window.matchMedia("(max-width: 768px)").matches)return this.isActive=!1,void(this.container.style.display="none");navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4&&(this.throttleDelay=600,this.maxRipples=8)}bindEvents(){if(!this.isActive)return;document.addEventListener("mousemove",e=>this.handleMouseMove(e)),document.addEventListener("click",e=>this.handleClick(e)),document.addEventListener("touchstart",e=>this.handleTouch(e),{passive:!0}),window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",e=>{e.matches?this.disable():this.enable()});window.matchMedia("(max-width: 768px)").addEventListener("change",e=>{e.matches?this.disable():this.enable()}),setInterval(()=>this.cleanupRipples(),2e3),this.monitorPerformance()}handleMouseMove(e){this.isActive&&this.shouldCreateRipple()&&(this.createTranquilRipples(e.clientX,e.clientY),this.lastRippleTime=Date.now())}handleClick(e){if(!this.isActive)return;const{clientX:t,clientY:n}=e;this.createLuxuriousClickEffect(t,n)}handleTouch(e){if(!this.isActive||!e.touches[0])return;const t=e.touches[0];this.createRipple(t.clientX,t.clientY,"medium")}shouldCreateRipple(){return Date.now()-this.lastRippleTime>this.throttleDelay}createRipple(e,t,n="medium",a="default"){if(!this.isActive||this.ripples.length>=this.maxRipples)return;const s=document.createElement("div");s.className=`ripple ${n} ${a}`;const i={small:120*Math.random()+80,medium:200*Math.random()+150,large:300*Math.random()+200,huge:400*Math.random()+300},o=i[n]||i.medium;s.style.width=`${o}px`,s.style.height=`${o}px`,s.style.left=e-o/2+"px",s.style.top=t-o/2+"px";const r=360*Math.random();if(s.style.transform=`scale(0) rotate(${r}deg)`,"rainbow"===a){const e=360*Math.random();s.style.background=`radial-gradient(circle, hsla(${e}, 80%, 70%, 0.8) 0%, hsla(${e+60}, 70%, 60%, 0.4) 40%, transparent 80%)`}else"gold"===a&&(s.style.background="radial-gradient(circle, rgba(255, 215, 0, 0.9) 0%, rgba(255, 165, 0, 0.6) 30%, rgba(255, 140, 0, 0.3) 60%, transparent 90%)");this.container.appendChild(s),this.ripples.push({element:s,createdAt:Date.now()});setTimeout(()=>{this.removeRipple(s)},"huge"===n?3500:"large"===n?2800:"small"===n?1200:1800)}removeRipple(e){e&&e.parentNode&&e.parentNode.removeChild(e),this.ripples=this.ripples.filter(t=>t.element!==e)}cleanupRipples(){const e=Date.now();this.ripples.filter(t=>e-t.createdAt>3e3).forEach(e=>{this.removeRipple(e.element)})}createTranquilRipples(e,t){this.createRipple(e,t,"small","elegant"),Math.random()<.12&&setTimeout(()=>{const n=20*Math.random()-10,a=20*Math.random()-10;this.createRipple(e+n,t+a,"small","subtle")},500*Math.random()+200),Math.random()<.05&&setTimeout(()=>{this.createRipple(e,t,"medium","subtle")},800*Math.random()+400)}createZenClickEffect(e,t){this.createInkDrops(e,t,6),setTimeout(()=>{this.createFloatingLeaves(e,t,4)},200),setTimeout(()=>{this.createSubtleGlow(e,t,120)},100),this.createTranquilDots(e,t,8)}createInkDrops(e,t,n){if(this.container)for(let a=0;a<n;a++){const s=document.createElement("div");s.className="ink-drop";const i=4*Math.random()+3;s.style.width=`${i}px`,s.style.height=`${i}px`,s.style.left=e-i/2+"px",s.style.top=t-i/2+"px";const o=360/n*a+(60*Math.random()-30),r=30+50*Math.random(),l=Math.cos(o*Math.PI/180)*r,c=Math.sin(o*Math.PI/180)*r,d=(.8*Math.random()+1.5).toFixed(2);s.style.setProperty("--dx",`${l}px`),s.style.setProperty("--dy",`${c}px`),s.style.animationDuration=`${d}s`,this.container.appendChild(s),setTimeout(()=>s.remove(),1e3*d)}}createSubtleGlow(e,t,n){if(!this.container)return;const a=document.createElement("div");a.className="subtle-glow",a.style.width=`${n}px`,a.style.height=`${n}px`,a.style.left=e-n/2+"px",a.style.top=t-n/2+"px",this.container.appendChild(a),setTimeout(()=>a.remove(),2e3)}createFloatingLeaves(e,t,n){if(this.container)for(let a=0;a<n;a++){const n=document.createElement("div");n.className="floating-leaf";const a=4*Math.random()+2,s=3*Math.random()+2;n.style.width=`${a}px`,n.style.height=`${s}px`,n.style.left=e-a/2+"px",n.style.top=t-s/2+"px";const i=360*Math.random(),o=40+60*Math.random(),r=Math.cos(i*Math.PI/180)*o,l=Math.sin(i*Math.PI/180)*o,c=(1.5*Math.random()+2).toFixed(2);n.style.setProperty("--dx",`${r}px`),n.style.setProperty("--dy",`${l}px`),n.style.animationDuration=`${c}s`;const d=360*Math.random();n.style.setProperty("--leaf-angle",`${d}deg`),this.container.appendChild(n),setTimeout(()=>n.remove(),1e3*c)}}createTranquilDots(e,t,n){if(this.container)for(let a=0;a<n;a++){const s=document.createElement("div");s.className="tranquil-dot",s.style.left=e-1+"px",s.style.top=t-1+"px";const i=360/n*a,o=20+40*Math.random(),r=Math.cos(i*Math.PI/180)*o,l=Math.sin(i*Math.PI/180)*o,c=(.5*Math.random()+1).toFixed(2);s.style.setProperty("--dx",`${r}px`),s.style.setProperty("--dy",`${l}px`),s.style.animationDuration=`${c}s`,this.container.appendChild(s),setTimeout(()=>s.remove(),1e3*c)}}createSakuraBurst(e,t,n=8){if(this.container)for(let a=0;a<n;a++){const n=document.createElement("div");n.className="sakura-petal";const a=12*Math.random()+8;n.style.width=`${a}px`,n.style.height=`${a}px`,n.style.left=e-a/2+"px",n.style.top=t-a/2+"px";const s=360*Math.random(),i=80+80*Math.random(),o=Math.cos(s*Math.PI/180)*i,r=Math.sin(s*Math.PI/180)*i,l=(1*Math.random()+2).toFixed(2);n.style.setProperty("--dx",`${o}px`),n.style.setProperty("--dy",`${r}px`),n.style.animationDuration=`${l}s`,this.container.appendChild(n),setTimeout(()=>n.remove(),1e3*l)}}createLuxuriousClickEffect(e,t){this.createRipple(e,t,"huge","gold"),this.createSakuraBurst(e,t,14),this.createKabukiSwirls(e,t,2),this.createFloatingElements(e,t,12),this.createSubtleGlow(e,t,200),this.createClickFlash(e,t)}createKabukiSwirls(e,t,n=2){if(this.container)for(let a=0;a<n;a++){const n=document.createElement("div");n.className="kabuki-swirl";const a=40+20*Math.random();n.style.width=`${a}px`,n.style.height=`${a}px`,n.style.left=e-a/2+"px",n.style.top=t-a/2+"px",n.style.animationDuration=`${(.4*Math.random()+.8).toFixed(2)}s`,this.container.appendChild(n),setTimeout(()=>n.remove(),1e3)}}createGoldFoilEffect(e,t){this.createGoldSparkle(e,t,60),this.createGoldBurst(e,t,20),this.createGoldParticles(e,t,18),setTimeout(()=>{this.createGoldFlakes(e,t,15)},50),setTimeout(()=>{this.createGoldShimmer(e,t,120)},80),setTimeout(()=>{this.createGoldSparkle(e,t,35),this.createGoldParticles(e,t,10)},150),setTimeout(()=>{this.createGoldFlakes(e,t,8)},300)}createGoldSparkle(e,t,n){if(!this.container)return;const a=document.createElement("div");a.className="gold-sparkle",a.style.width=`${n}px`,a.style.height=`${n}px`,a.style.left=e-n/2+"px",a.style.top=t-n/2+"px",this.container.appendChild(a),setTimeout(()=>a.remove(),600)}createGoldParticles(e,t,n){if(this.container)for(let a=0;a<n;a++){const s=document.createElement("div");s.className="gold-particle";const i=6*Math.random()+4;s.style.width=`${i}px`,s.style.height=`${i}px`,s.style.left=e-i/2+"px",s.style.top=t-i/2+"px";const o=360/n*a+(90*Math.random()-45),r=80+120*Math.random(),l=Math.cos(o*Math.PI/180)*r,c=Math.sin(o*Math.PI/180)*r,d=(.6*Math.random()+1.2).toFixed(2);s.style.setProperty("--dx",`${l}px`),s.style.setProperty("--dy",`${c}px`),s.style.animationDuration=`${d}s`;const h=360*Math.random();s.style.setProperty("--particle-angle",`${h}deg`),this.container.appendChild(s),setTimeout(()=>s.remove(),1e3*d)}}createGoldShimmer(e,t,n){if(!this.container)return;const a=document.createElement("div");a.className="gold-shimmer",a.style.width=`${n}px`,a.style.height=`${n}px`,a.style.left=e-n/2+"px",a.style.top=t-n/2+"px",this.container.appendChild(a),setTimeout(()=>a.remove(),1e3)}createGoldFlakes(e,t,n){if(this.container)for(let a=0;a<n;a++){const n=document.createElement("div");n.className="gold-flake";const a=8*Math.random()+3,s=6*Math.random()+2;n.style.width=`${a}px`,n.style.height=`${s}px`,n.style.left=e-a/2+"px",n.style.top=t-s/2+"px";const i=360*Math.random(),o=60+100*Math.random(),r=Math.cos(i*Math.PI/180)*o,l=Math.sin(i*Math.PI/180)*o,c=(1*Math.random()+1.5).toFixed(2);n.style.setProperty("--dx",`${r}px`),n.style.setProperty("--dy",`${l}px`),n.style.animationDuration=`${c}s`;const d=360*Math.random();n.style.setProperty("--flake-angle",`${d}deg`),this.container.appendChild(n),setTimeout(()=>n.remove(),1e3*c)}}createGoldBurst(e,t,n){if(this.container)for(let a=0;a<n;a++){const s=document.createElement("div");s.className="gold-burst",s.style.left=e-2+"px",s.style.top=t-2+"px";const i=360/n*a,o=40+60*Math.random(),r=Math.cos(i*Math.PI/180)*o,l=Math.sin(i*Math.PI/180)*o,c=(.3*Math.random()+.4).toFixed(2);s.style.setProperty("--dx",`${r}px`),s.style.setProperty("--dy",`${l}px`),s.style.animationDuration=`${c}s`,this.container.appendChild(s),setTimeout(()=>s.remove(),1e3*c)}}createFloatingElements(e,t,n=6){if(!this.container)return;if(!(this.container.querySelectorAll(".refined-particle").length>=15))for(let a=0;a<n;a++){const n=document.createElement("div");n.className="refined-particle";const a=3*Math.random()+2;n.style.width=`${a}px`,n.style.height=`${a}px`,n.style.left=e-a/2+"px",n.style.top=t-a/2+"px";const s=360*Math.random(),i=60+60*Math.random(),o=Math.cos(s*Math.PI/180)*i,r=Math.sin(s*Math.PI/180)*i,l=(1.2*Math.random()+2).toFixed(2);n.style.setProperty("--dx",`${o}px`),n.style.setProperty("--dy",`${r}px`),n.style.animationDuration=`${l}s`;const c=.3+.3*Math.random();n.style.background=`radial-gradient(\n        circle,\n        rgba(75, 85, 99, ${c}) 0%,\n        rgba(107, 114, 128, ${.6*c}) 50%,\n        transparent 100%\n      )`,this.container.appendChild(n),setTimeout(()=>n.remove(),1e3*l)}}createClickFlash(e,t){if(!this.container)return;const n=document.createElement("div");n.className="click-flash";n.style.width="20px",n.style.height="20px",n.style.left=e-10+"px",n.style.top=t-10+"px",this.container.appendChild(n),setTimeout(()=>n.remove(),600)}enable(){this.isActive=!0,this.container&&(this.container.style.display="block")}disable(){this.isActive=!1,this.container&&(this.container.style.display="none"),this.ripples.forEach(e=>{this.removeRipple(e.element)})}toggle(){this.isActive?this.disable():this.enable()}createCustomRipple(e,t,n,a=200){if(!this.isActive)return;const s=document.createElement("div");s.className="ripple",s.style.background=`radial-gradient(circle, ${n}40 0%, ${n}20 20%, ${n}10 40%, transparent 80%)`,s.style.width=`${a}px`,s.style.height=`${a}px`,s.style.left=e-a/2+"px",s.style.top=t-a/2+"px",this.container.appendChild(s),setTimeout(()=>{this.removeRipple(s)},1500)}monitorPerformance(){let e=0,t=performance.now();const n=a=>{if(e++,a-t>=1e3){Math.round(1e3*e/(a-t))<50&&!this.performanceOptimized&&this.optimizeForPerformance(),e=0,t=a}requestAnimationFrame(n)};requestAnimationFrame(n)}optimizeForPerformance(){for(this.performanceOptimized=!0,this.throttleDelay=Math.max(1.5*this.throttleDelay,600),this.maxRipples=Math.max(this.maxRipples-3,6);this.ripples.length>this.maxRipples;){const e=this.ripples.shift();this.removeRipple(e.element)}}}let waterRipples,sakuraEffect;document.addEventListener("DOMContentLoaded",()=>{waterRipples=new WaterRippleEffect,window.waterRipples=waterRipples}),window.toggleRipples=function(){window.waterRipples&&window.waterRipples.toggle()},window.createCustomRipple=function(e,t,n,a){window.waterRipples&&window.waterRipples.createCustomRipple(e,t,n,a)};class RainEffect{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="rain-canvas",this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.resize(),this.sizeMultiplier=this.getSizeMultiplier(),window.addEventListener("resize",()=>this.resize()),this.drops=[],this.dropCount=Math.floor(window.innerWidth/2.5);for(let e=0;e<this.dropCount;e++)this.drops.push(this.createDrop(!0));this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",e=>{e.touches&&e.touches[0]&&this.handleMouseMove(e.touches[0])},{passive:!0}),this.wind=0,this.windTarget=0,this.lastWindChange=performance.now(),this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sizeMultiplier=this.getSizeMultiplier()}getSizeMultiplier(){const e=window.innerWidth/768;return Math.min(Math.max(e,.6),1.2)}createDrop(e=!1){return{x:Math.random()*this.canvas.width,y:e?Math.random()*this.canvas.height:-20,length:15+25*Math.random(),speed:3+5*Math.random(),opacity:.3+.4*Math.random(),thickness:.8+.7*Math.random()}}handleMouseMove(e){const t=window.innerWidth/2,n=(e.clientX-t)/t;this.windTarget=2*n}animate(){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.lineCap="round";const t=performance.now();t-this.lastWindChange>3e3&&(this.windTarget=2*(2*Math.random()-1),this.lastWindChange=t),this.wind+=.015*(this.windTarget-this.wind);for(const t of this.drops)e.globalAlpha=t.opacity,e.lineWidth=t.thickness,e.strokeStyle=`rgba(200, 220, 255, ${t.opacity})`,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+3*this.wind,t.y+t.length),e.stroke(),t.y>this.canvas.height-50&&Math.random()<.02&&(e.globalAlpha=.5*t.opacity,e.strokeStyle=`rgba(123, 167, 212, ${.5*t.opacity})`,e.lineWidth=.5,e.beginPath(),e.arc(t.x,this.canvas.height-10,2+3*Math.random(),0,2*Math.PI),e.stroke()),t.x+=this.wind*(t.speed/4),t.y+=t.speed,t.x<-30&&(t.x=this.canvas.width+30),t.x>this.canvas.width+30&&(t.x=-30),t.y>this.canvas.height+10&&Object.assign(t,this.createDrop());requestAnimationFrame(this.animate)}}class SakuraEffect{constructor(e=!1){this.canvas=document.createElement("canvas"),this.canvas.className="sakura-canvas",this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.resize(),this.sizeMultiplier=this.getSizeMultiplier(),window.addEventListener("resize",()=>this.resize()),this.petals=[],this.petalCount=Math.floor(window.innerWidth/15),this.isInBurstPhase=e,this.wind=0,this.windTarget=0,this.lastWindChange=performance.now(),this.initializePetals(e),this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",e=>{e.touches&&e.touches[0]&&this.handleMouseMove(e.touches[0])},{passive:!0}),this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sizeMultiplier=this.getSizeMultiplier()}getSizeMultiplier(){const e=window.innerWidth/768;return Math.min(Math.max(e,.6),1.2)}initializePetals(e){const t=e?2*this.petalCount:this.petalCount;for(let n=0;n<t;n++)this.petals.push(this.createPetal(!0,e))}createPetal(e=!1,t=!1){return{x:Math.random()*this.canvas.width,y:e?Math.random()*this.canvas.height:-20,size:(6+11*Math.random())*this.sizeMultiplier,speed:.3+.7*Math.random(),opacity:.7+.3*Math.random(),drift:1.5*Math.random()-.75,rotationSpeed:2*(Math.random()-.5),rotation:Math.random()*Math.PI*2,swayAmplitude:40+50*Math.random(),swaySpeed:.01+.02*Math.random(),swayOffset:Math.random()*Math.PI*2,windResistance:.4+.6*Math.random(),turbulence:.4*Math.random(),petalType:Math.floor(3*Math.random()),color:this.getSakuraColor(),isBurst:t}}getSakuraColor(){const e=[{r:255,g:182,b:193},{r:255,g:192,b:203},{r:255,g:240,b:245},{r:255,g:228,b:225},{r:255,g:255,b:255},{r:250,g:218,b:221},{r:255,g:235,b:238}];return e[Math.floor(Math.random()*e.length)]}handleMouseMove(e){const t=window.innerWidth/2,n=(e.clientX-t)/t;this.windTarget=2.5*n}animate(){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);const t=performance.now();t-this.lastWindChange>4e3&&(this.windTarget=2.5*(2*Math.random()-1),this.lastWindChange=t),this.wind+=.015*(this.windTarget-this.wind);for(const n of this.petals){e.globalAlpha=n.opacity;const a=.001*t,s=Math.sin(a*n.swaySpeed+n.swayOffset)*n.swayAmplitude;e.save(),e.translate(n.x+s,n.y);const i=.08*this.wind;e.rotate(n.rotation+i);const{r:o,g:r,b:l}=n.color;e.fillStyle=`rgba(${o}, ${r}, ${l}, ${n.opacity})`,this.drawSakuraPetal(e,0,0,n.size,n.petalType),e.restore();const c=this.wind*n.windResistance,d=.3*Math.sin(8e-4*t*n.turbulence),h=.2*Math.cos(.001*t*n.turbulence);n.x+=c+n.drift+d,n.y+=n.speed+.05*Math.abs(c)+h,n.rotation+=.015*n.rotationSpeed+.008*Math.abs(c),n.x<-30&&(n.x=this.canvas.width+30),n.x>this.canvas.width+30&&(n.x=-30),n.y>this.canvas.height+30&&Object.assign(n,this.createPetal())}requestAnimationFrame(this.animate)}drawSakuraPetal(e,t,n,a,s){const i=a/10;if(e.beginPath(),0===s){const a=4*i,s=6*i;e.moveTo(t,n+.4*s),e.bezierCurveTo(t-.3*a,n+.1*s,t-.7*a,n-.2*s,t-.4*a,n-.4*s),e.quadraticCurveTo(t-.1*a,n-.5*s,t,n-.3*s),e.quadraticCurveTo(t+.1*a,n-.5*s,t+.4*a,n-.4*s),e.bezierCurveTo(t+.7*a,n-.2*s,t+.3*a,n+.1*s,t,n+.4*s)}else if(1===s){const a=3.5*i,s=5.5*i;e.moveTo(t,n+.5*s),e.bezierCurveTo(t-.4*a,n+.1*s,t-.8*a,n-.1*s,t-.5*a,n-.3*s),e.quadraticCurveTo(t-.2*a,n-.4*s,t-.1*a,n-.2*s),e.quadraticCurveTo(t,n-.5*s,t+.1*a,n-.2*s),e.quadraticCurveTo(t+.2*a,n-.4*s,t+.5*a,n-.3*s),e.bezierCurveTo(t+.8*a,n-.1*s,t+.4*a,n+.1*s,t,n+.5*s)}else{const a=3*i,s=5*i;e.moveTo(t,n+.5*s),e.bezierCurveTo(t-.5*a,n+.2*s,t-.6*a,n-.1*s,t-.3*a,n-.4*s),e.quadraticCurveTo(t,n-.45*s,t+.3*a,n-.4*s),e.bezierCurveTo(t+.6*a,n-.1*s,t+.5*a,n+.2*s,t,n+.5*s)}if(e.closePath(),e.fill(),a>6){const a=0===s?4*i:1===s?3.5*i:3*i,o=0===s?6*i:1===s?5.5*i:5*i;e.strokeStyle="rgba(255, 182, 193, 0.3)",e.lineWidth=.5*i,e.beginPath(),e.moveTo(t,n+.3*o),e.lineTo(t,n-.2*o),e.moveTo(t-.2*a,n+.1*o),e.quadraticCurveTo(t-.1*a,n,t-.15*a,n-.2*o),e.moveTo(t+.2*a,n+.1*o),e.quadraticCurveTo(t+.1*a,n,t+.15*a,n-.2*o),e.stroke()}}startBurstPhase(){this.isInBurstPhase=!0;const e=Math.floor(window.innerWidth/8);for(let t=0;t<e;t++)this.petals.push(this.createPetal(!1,!0));setTimeout(()=>{this.isInBurstPhase=!1},2500)}destroy(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}window.enableSakura=function(e=!1){sakuraEffect?(sakuraEffect.canvas.style.display="",e&&!sakuraEffect.isInBurstPhase&&sakuraEffect.startBurstPhase()):(sakuraEffect=new SakuraEffect(e),window.sakuraEffect=sakuraEffect)},window.disableSakura=function(){sakuraEffect&&(sakuraEffect.destroy(),sakuraEffect=null,window.sakuraEffect=null)};const sakuraCSS="\n.sakura-canvas {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 1;\n  opacity: 0.9;\n}\n",sakuraStyle=document.createElement("style");let rainEffect,snowEffect;function initScrollButtons(){document.querySelectorAll("[data-scroll-target]").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-scroll-target");scrollToSection(t)})})}function generateSeasonGallery(){const e=document.getElementById("season-nav"),t=document.getElementById("season-content");if(!e||!t)return;let n="",a="",s=!0;for(const[e,t]of Object.entries(SEASON_DATA))"tsuyu"!==e&&(n+=`\n      <button class="season-btn ${s?"active":""}" \n              data-season="${e}" \n              role="tab" \n              aria-controls="${e}-content" \n              aria-selected="${s?"true":"false"}" \n              aria-label="${t.name}の楽曲を再生">\n        <span class="season-icon" aria-hidden="true">${t.icon}</span>\n        <span class="season-name">${t.name}</span>\n      </button>\n    `,a+=`\n      <div class="season-panel ${s?"active":""}" \n           id="${e}-content" \n           role="tabpanel" \n           aria-labelledby="${e}-tab" \n           data-season="${e}">\n        <div class="season-visual">\n          <video class="season-video"\n                 controls\n                 preload="none"\n                 loading="lazy"\n                 poster="${t.poster}"\n                 tabindex="0"\n                 playsinline\n                 aria-label="${t.name}をテーマにしたデモ動画 - クリックまたはEnterキーで再生">\n            ${t.video.webm?`<source data-src="${t.video.webm}" type="video/webm">`:""}\n            <source data-src="${t.video.mp4}" type="video/mp4">\n            お使いのブラウザは動画再生に対応していません。\n          </video>\n        </div>\n        <div class="season-tracks">\n          <h3 class="season-title">${t.title}</h3>\n          <p class="season-description">${t.description}</p>\n          <div class="track-list">\n            ${t.tracks.map(e=>`\n              <div class="track">\n                <audio controls preload="none" aria-label="${e.title} - ${t.name}の楽曲">\n                  <source src="${e.src}" type="audio/mpeg">\n                  お使いのブラウザは音声再生に対応していません。\n                </audio>\n                <div class="track-info">\n                  <h4 class="track-title">${e.title}</h4>\n                  <p class="track-description">${e.description}</p>\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n      </div>\n    `,s=!1);e.innerHTML=n,t.innerHTML=a,window.seasonsGallery&&"function"==typeof window.seasonsGallery.setupAudioElements&&window.seasonsGallery.setupAudioElements()}function generateSocialLinks(){const e=document.getElementById("social-links");if(!e)return;const t=[{url:"https://suno.com/@shuka_sounds",label:"Suno アカウント",name:"Suno",icon:null,image:"./img/suno.webp",enabled:!0,class:"suno"},{url:"https://www.instagram.com/shuka_sounds?igsh=MXhrd29oeWJuNHB5OQ==",label:"Instagram アカウント",name:"Instagram",icon:'<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>',enabled:!0,class:"instagram"},{url:"https://youtube.com/@shuka_artist",label:"YouTube チャンネル",name:"YouTube",icon:'<path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>',enabled:!1}].map(e=>{const t=e.enabled?`href="${e.url}" rel="noopener noreferrer" target="_blank"`:"",n=`social-link${e.enabled?"":" disabled"}${e.class?" "+e.class:""}`,a=e.image?`<img src="${e.image}" alt="${e.name}" class="social-icon-img" width="24" height="24" aria-hidden="true">`:`<svg class="social-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n        ${e.icon}\n      </svg>`;return`\n    <a ${t} class="${n}" aria-label="${e.label}">\n      ${a}\n      <span class="sr-only">${e.name}</span>\n    </a>`}).join("");e.innerHTML=t}function generateCreatorSection(){const e=document.getElementById("creator-section");if(!e)return;e.innerHTML='\n    <div class="creator-info">\n      <img src="./img/hide.webp" alt="ひで" class="creator-avatar" width="24" height="24">\n      <span class="creator-name">ひで</span>\n      <span class="creator-label">のNote</span>\n      <a href="https://note.com/yamazaki2357" rel="noopener noreferrer" target="_blank" class="social-link note" aria-label="製作者のNote">\n        <img src="./img/note.jpg" alt="Note" class="social-icon-img" width="20" height="20" aria-hidden="true">\n        <span class="sr-only">Note</span>\n      </a>\n    </div>'}function handleImageError(e){e.dataset.errorHandled||(e.dataset.errorHandled="true",console.warn("Failed to load image:",e.src),(e.classList.contains("about-image")||e.classList.contains("creator-avatar"))&&(e.style.display="none"))}function setupImageErrorHandling(){document.querySelectorAll("img").forEach(e=>{e.addEventListener("error",()=>handleImageError(e))})}sakuraStyle.textContent=sakuraCSS,document.head.appendChild(sakuraStyle),window.enableRain=function(){rainEffect?rainEffect.canvas.style.display="":(rainEffect=new RainEffect,window.rainEffect=rainEffect)},window.disableRain=function(){rainEffect&&(rainEffect.canvas.remove(),rainEffect=null,window.rainEffect=null)},"undefined"!=typeof module&&module.exports&&(module.exports={RainEffect:RainEffect,SakuraEffect:SakuraEffect}),window.handleLogoClick=function(e){if(e.preventDefault(),window.seasonsGallery&&"function"==typeof window.seasonsGallery.switchToSeason){window.seasonsGallery.currentSeason="tsuyu",document.body.setAttribute("data-season","tsuyu");const e=document.querySelector(".about-image");if(e){e.src="./img/秀歌.webp",e.srcset="./img/秀歌.webp";const t=e.parentElement.querySelector("source");t&&(t.srcset="./img/秀歌.webp")}"function"==typeof window.enableRain&&window.enableRain(),window.seasonsGallery.updateSeasonButtons("summer"),window.seasonsGallery.updateSeasonPanels("summer",!1),window.seasonsGallery.updateURL("tsuyu")}const t=document.getElementById("nav-menu"),n=document.getElementById("nav-toggle");t&&t.classList.contains("active")&&(t.classList.remove("active"),n.classList.remove("active"),n.setAttribute("aria-expanded","false"),document.body.style.overflow="")},document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("loaded"),initAccessibilityFeatures(),initResourcePrefetching(),initScrollButtons(),void 0!==Navigation&&(window.navigationInstance=new Navigation),generateSocialLinks(),generateCreatorSection(),generateSeasonGallery(),setupImageErrorHandling(),window.seasonsGallery=new SeasonsGallery,"function"==typeof initSeasonSelector&&initSeasonSelector(),window.seasonsGallery&&"function"==typeof window.seasonsGallery.refresh&&window.seasonsGallery.refresh(),setupFooterSeasonButtons()});class SnowEffect{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="snow-canvas",this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.resize(),this.sizeMultiplier=this.getSizeMultiplier(),window.addEventListener("resize",()=>this.resize()),this.flakes=[],this.flakeCount=Math.floor(window.innerWidth/8);for(let e=0;e<this.flakeCount;e++)this.flakes.push(this.createFlake(!0));this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",e=>{e.touches&&e.touches[0]&&this.handleMouseMove(e.touches[0])},{passive:!0}),this.wind=0,this.windTarget=0,this.lastWindChange=performance.now(),this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sizeMultiplier=this.getSizeMultiplier()}getSizeMultiplier(){const e=window.innerWidth/768;return Math.min(Math.max(e,.6),1.2)}createFlake(e=!1){return{x:Math.random()*this.canvas.width,y:e?Math.random()*this.canvas.height:-20,size:(2+6*Math.random())*this.sizeMultiplier,speed:.5+1.5*Math.random(),opacity:.4+.6*Math.random(),drift:.5*Math.random()-.25,rotationSpeed:2*(Math.random()-.5),rotation:0}}handleMouseMove(e){const t=window.innerWidth/2,n=(e.clientX-t)/t;this.windTarget=.5*n}animate(){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);const t=performance.now();t-this.lastWindChange>4e3&&(this.windTarget=.5*(2*Math.random()-1),this.lastWindChange=t),this.wind+=.01*(this.windTarget-this.wind);for(const t of this.flakes)e.globalAlpha=t.opacity,e.fillStyle=`rgba(255, 255, 255, ${t.opacity})`,e.save(),e.translate(t.x,t.y),e.rotate(t.rotation),t.size>4?this.drawStar(e,0,0,t.size/2,t.size/4,6):(e.beginPath(),e.arc(0,0,t.size/2,0,2*Math.PI),e.fill()),e.restore(),t.x+=this.wind+t.drift,t.y+=t.speed,t.rotation+=.02*t.rotationSpeed,t.x<-20&&(t.x=this.canvas.width+20),t.x>this.canvas.width+20&&(t.x=-20),t.y>this.canvas.height+20&&Object.assign(t,this.createFlake());requestAnimationFrame(this.animate)}drawStar(e,t,n,a,s,i){let o=Math.PI/2*3,r=t,l=n;const c=Math.PI/i;e.beginPath(),e.moveTo(t,n-a);for(let d=0;d<i;d++)r=t+Math.cos(o)*a,l=n+Math.sin(o)*a,e.lineTo(r,l),o+=c,r=t+Math.cos(o)*s,l=n+Math.sin(o)*s,e.lineTo(r,l),o+=c;e.lineTo(t,n-a),e.closePath(),e.fill()}}window.enableSnow=function(){snowEffect?snowEffect.canvas.style.display="":(snowEffect=new SnowEffect,window.snowEffect=snowEffect)},window.disableSnow=function(){snowEffect&&(snowEffect.canvas.remove(),snowEffect=null,window.snowEffect=null)};const snowCSS="\n.snow-canvas {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 1;\n  opacity: 0.8;\n}\n",snowStyle=document.createElement("style");snowStyle.textContent=snowCSS,document.head.appendChild(snowStyle);class AutumnLeavesEffect{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="autumn-leaves-canvas",this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.resize(),this.sizeMultiplier=this.getSizeMultiplier(),window.addEventListener("resize",()=>this.resize()),this.leaves=[],this.leafCount=Math.floor(window.innerWidth/12);for(let e=0;e<this.leafCount;e++)this.leaves.push(this.createLeaf(!0));this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",e=>{e.touches&&e.touches[0]&&this.handleMouseMove(e.touches[0])},{passive:!0}),this.wind=0,this.windTarget=0,this.lastWindChange=performance.now(),this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sizeMultiplier=this.getSizeMultiplier()}getSizeMultiplier(){const e=window.innerWidth/768;return Math.min(Math.max(e,.6),1.2)}createLeaf(e=!1){const t=["maple","ginkgo"],n=t[Math.floor(Math.random()*t.length)];return{x:Math.random()*this.canvas.width,y:e?Math.random()*this.canvas.height:-50,type:n,size:(8+16*Math.random())*this.sizeMultiplier,speed:.8+1.2*Math.random(),opacity:.6+.4*Math.random(),drift:1*Math.random()-.5,rotationSpeed:3*(Math.random()-.5),rotation:Math.random()*Math.PI*2,swayAmplitude:20+30*Math.random(),swaySpeed:.02+.03*Math.random(),swayOffset:Math.random()*Math.PI*2,color:this.getLeafColor(n)}}getLeafColor(e){if("maple"===e){const e=[{r:200,g:30,b:30},{r:220,g:20,b:60},{r:255,g:69,b:0},{r:255,g:120,b:0},{r:255,g:160,b:0}];return e[Math.floor(Math.random()*e.length)]}{const e=[{r:255,g:215,b:0},{r:255,g:223,b:0},{r:255,g:255,b:0},{r:238,g:221,b:130},{r:255,g:239,b:145}];return e[Math.floor(Math.random()*e.length)]}}handleMouseMove(e){const t=window.innerWidth/2,n=(e.clientX-t)/t;this.windTarget=1.5*n}animate(){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);const t=performance.now();t-this.lastWindChange>3500&&(this.windTarget=1.5*(2*Math.random()-1),this.lastWindChange=t),this.wind+=.015*(this.windTarget-this.wind);for(const n of this.leaves){e.globalAlpha=n.opacity;const a=.001*t,s=Math.sin(a*n.swaySpeed+n.swayOffset)*n.swayAmplitude;e.save(),e.translate(n.x+s,n.y),e.rotate(n.rotation);const{r:i,g:o,b:r}=n.color;e.fillStyle=`rgba(${i}, ${o}, ${r}, ${n.opacity})`,"maple"===n.type?this.drawMapleLeaf(e,0,0,n.size):this.drawGinkgoLeaf(e,0,0,n.size),e.restore(),n.x+=this.wind+n.drift,n.y+=n.speed,n.rotation+=.02*n.rotationSpeed,n.x<-50&&(n.x=this.canvas.width+50),n.x>this.canvas.width+50&&(n.x=-50),n.y>this.canvas.height+50&&Object.assign(n,this.createLeaf())}requestAnimationFrame(this.animate)}drawMapleLeaf(e,t,n,a){const s=a/15;e.beginPath(),e.moveTo(t,n-9*s),e.lineTo(t-2*s,n-6*s),e.lineTo(t-7*s,n-8*s),e.lineTo(t-4*s,n-3*s),e.lineTo(t-9*s,n-2*s),e.lineTo(t-5*s,n+1*s),e.lineTo(t-7*s,n+6*s),e.lineTo(t,n+3*s),e.lineTo(t+7*s,n+6*s),e.lineTo(t+5*s,n+1*s),e.lineTo(t+9*s,n-2*s),e.lineTo(t+4*s,n-3*s),e.lineTo(t+7*s,n-8*s),e.lineTo(t+2*s,n-6*s),e.closePath(),e.fill()}drawGinkgoLeaf(e,t,n,a){const s=a/20;e.beginPath(),e.moveTo(t,n+8*s),e.quadraticCurveTo(t-8*s,n+6*s,t-8*s,n),e.quadraticCurveTo(t-8*s,n-6*s,t,n-8*s),e.quadraticCurveTo(t+8*s,n-6*s,t+8*s,n),e.quadraticCurveTo(t+8*s,n+6*s,t,n+8*s),e.closePath(),e.fill(),e.globalCompositeOperation="destination-out",e.beginPath(),e.moveTo(t,n),e.quadraticCurveTo(t-2*s,n-2*s,t,n-4*s),e.quadraticCurveTo(t+2*s,n-2*s,t,n),e.closePath(),e.fill(),e.globalCompositeOperation="source-over"}}let autumnLeavesEffect;window.enableAutumnLeaves=function(){autumnLeavesEffect?autumnLeavesEffect.canvas.style.display="":(autumnLeavesEffect=new AutumnLeavesEffect,window.autumnLeavesEffect=autumnLeavesEffect)},window.disableAutumnLeaves=function(){autumnLeavesEffect&&(autumnLeavesEffect.canvas.remove(),autumnLeavesEffect=null,window.autumnLeavesEffect=null)};const autumnLeavesCSS="\n.autumn-leaves-canvas {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 1;\n  opacity: 0.9;\n}\n",autumnLeavesStyle=document.createElement("style");autumnLeavesStyle.textContent=autumnLeavesCSS,document.head.appendChild(autumnLeavesStyle);class SummerWillowEffect{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="summer-willow-canvas",this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.resize(),window.addEventListener("resize",()=>this.resize()),this.willowLeaves=[],this.leafCount=Math.floor(window.innerWidth/10);for(let e=0;e<this.leafCount;e++)this.willowLeaves.push(this.createWillowLeaf(!0));this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",e=>{e.touches&&e.touches[0]&&this.handleMouseMove(e.touches[0])},{passive:!0}),this.wind=0,this.windTarget=0,this.lastWindChange=performance.now(),this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}createWillowLeaf(e=!1){return{x:Math.random()*this.canvas.width,y:e?Math.random()*this.canvas.height:-30,length:15+25*Math.random(),width:3+4*Math.random(),speed:.4+.8*Math.random(),opacity:.5+.4*Math.random(),drift:2*Math.random()-1,rotationSpeed:2.5*(Math.random()-.5),rotation:Math.random()*Math.PI*2,swayAmplitude:50+60*Math.random(),swaySpeed:.02+.025*Math.random(),swayOffset:Math.random()*Math.PI*2,curvature:.1+.3*Math.random(),windResistance:.3+.7*Math.random(),turbulence:.5*Math.random(),color:this.getWillowColor()}}getWillowColor(){const e=[{r:50,g:150,b:50},{r:60,g:180,b:60},{r:40,g:140,b:80},{r:70,g:160,b:70},{r:80,g:200,b:80},{r:45,g:130,b:90},{r:90,g:190,b:90}];return e[Math.floor(Math.random()*e.length)]}handleMouseMove(e){const t=window.innerWidth/2,n=(e.clientX-t)/t;this.windTarget=3.5*n}animate(){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);const t=performance.now();t-this.lastWindChange>3e3&&(this.windTarget=3.5*(2*Math.random()-1),this.lastWindChange=t),this.wind+=.02*(this.windTarget-this.wind);for(const n of this.willowLeaves){e.globalAlpha=n.opacity;const a=.001*t,s=Math.sin(a*n.swaySpeed+n.swayOffset)*n.swayAmplitude;e.save(),e.translate(n.x+s,n.y);const i=.1*this.wind;e.rotate(n.rotation+i);const{r:o,g:r,b:l}=n.color;e.fillStyle=`rgba(${o}, ${r}, ${l}, ${n.opacity})`,e.strokeStyle=`rgba(${o-20}, ${r-20}, ${l-10}, ${.8*n.opacity})`,e.lineWidth=.5,this.drawWillowLeaf(e,0,0,n.length,n.width,n.curvature),e.restore();const c=this.wind*n.windResistance,d=.5*Math.sin(.001*t*n.turbulence),h=.3*Math.cos(.0015*t*n.turbulence);n.x+=c+n.drift+d,n.y+=n.speed+.1*Math.abs(c)+h,n.rotation+=.02*n.rotationSpeed+.01*Math.abs(c),n.x<-60&&(n.x=this.canvas.width+60),n.x>this.canvas.width+60&&(n.x=-60),n.y>this.canvas.height+60&&Object.assign(n,this.createWillowLeaf())}requestAnimationFrame(this.animate)}drawWillowLeaf(e,t,n,a,s,i){e.beginPath();const o=a/2,r=s/2;e.moveTo(t,n-o),e.quadraticCurveTo(t+r+10*i,n-.3*o,t+r,n),e.quadraticCurveTo(t+r-5*i,n+.3*o,t,n+o),e.quadraticCurveTo(t-r+5*i,n+.3*o,t-r,n),e.quadraticCurveTo(t-r-10*i,n-.3*o,t,n-o),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t,n-.8*o),e.quadraticCurveTo(t+3*i,n,t,n+.8*o),e.stroke()}}let summerWillowEffect;window.enableSummerWillow=function(){summerWillowEffect?summerWillowEffect.canvas.style.display="":(summerWillowEffect=new SummerWillowEffect,window.summerWillowEffect=summerWillowEffect)},window.disableSummerWillow=function(){summerWillowEffect&&(summerWillowEffect.canvas.remove(),summerWillowEffect=null,window.summerWillowEffect=null)};const summerWillowCSS="\n.summer-willow-canvas {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 1;\n  opacity: 0.85;\n}\n",summerWillowStyle=document.createElement("style");summerWillowStyle.textContent=summerWillowCSS,document.head.appendChild(summerWillowStyle);